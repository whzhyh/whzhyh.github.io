<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>DigitalOcean mysql无法启动 | reStart</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">DigitalOcean mysql无法启动</h1><a id="logo" href="/.">reStart</a><p class="description">再出发</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">DigitalOcean mysql无法启动</h1><div class="post-meta">Jan 19, 2014<span> | </span><span class="category"><a href="/categories/database/">database</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>&#x770B;&#x5230;DigitalOcean&#x7684;vps&#x4EF7;&#x683C;&#x4E0D;&#x8D35;&#xFF0C;&#x60F3;&#x88C5;&#x6765;&#x8BD5;&#x8BD5;&#xFF0C;&#x5982;&#x679C;&#x6548;&#x679C;&#x597D;&#x7684;&#x8BDD;&#xFF0C;&#x5C31;&#x628A;godaddy&#x4E0A;&#x7684;&#x535A;&#x5BA2;&#x8FC1;&#x79FB;&#x8FC7;&#x6765;&#x3002;&#x4F46;&#x662F;&#x88C5;&#x597D;mysql&#x4E4B;&#x540E;&#xFF0C;&#x65E0;&#x6CD5;&#x542F;&#x52A8;&#xFF0C;&#x8BA9;&#x6211;&#x5F88;&#x662F;&#x90C1;&#x95F7;&#x3002;</p>
<p>&#x4E0B;&#x9762;&#x6211;&#x4EEC;&#x6765;&#x770B;&#x4E0B;&#x9519;&#x8BEF;&#x65E5;&#x5FD7;&#x5427;&#xFF0C;&#x5927;&#x6982;&#x5C31;&#x662F;&#x8FD9;&#x4E2A;&#x6837;&#x5B50;&#x7684;&#xFF1A;</p>
<pre>
131005 14:11:41 [Note] Plugin &apos;FEDERATED&apos; is disabled.
131005 14:11:41 InnoDB: The InnoDB memory heap is disabled
131005 14:11:41 InnoDB: Mutexes and rw_locks use GCC atomic builtins
131005 14:11:41 InnoDB: Compressed tables use zlib 1.2.3.4
131005 14:11:41 InnoDB: Initializing buffer pool, size = 128.0M
InnoDB: mmap(135987200 bytes) failed; errno 12
131005 14:11:41 InnoDB: Completed initialization of buffer pool
131005 14:11:41 InnoDB: Fatal error: cannot allocate memory for the buffer pool
131005 14:11:41 [ERROR] Plugin &apos;InnoDB&apos; init function returned error.
131005 14:11:41 [ERROR] Plugin &apos;InnoDB&apos; registration as a STORAGE ENGINE failed.
131005 14:11:41 [ERROR] Unknown/unsupported storage engine: InnoDB
</pre>

<p>&#x5F00;&#x59CB;&#x603B;&#x4EE5;&#x4E3A;&#x662F;mysql&#x914D;&#x7F6E;&#x7684;&#x95EE;&#x9898;&#xFF0C;&#x540E;&#x6765;&#x7ECF;&#x8FC7;&#x7814;&#x7A76;&#xFF0C;&#x5C45;&#x7136;&#x662F;&#x56E0;&#x4E3A;&#x6CA1;&#x6709;&#x5F00;&#x542F; Swap Space&#x3002;&#x540C;&#x6837;&#x7684;&#x95EE;&#x9898;&#x5176;&#x4ED6;&#x4EBA;&#x4E5F;&#x9047;&#x5230;&#x8FC7;&#x3002;&#x4E0D;&#x5F97;&#x4E0D;&#x8BF4;&#xFF0C;&#x8FD9;&#x5E94;&#x8BE5;&#x7B97;&#x662F;DigitalOcean&#x7684;bug&#x5427;&#x3002;</p>
<p>&#x5F00;&#x542F;Swap Space&#x7684;&#x8FC7;&#x7A0B;&#x7565;&#x590D;&#x6742;&#xFF0C;&#x6211;&#x5C31;&#x5077;&#x4E0B;&#x61D2;&#xFF0C;&#x628A;&#x522B;&#x4EBA;&#x7684;&#x65B9;&#x6CD5;copy&#x8FC7;&#x6765;&#x4E86;&#x3002;</p>
<h2 id="check-for-swap-space"><a href="#Check-for-Swap-Space" class="headerlink" title="Check for Swap Space"></a>Check for Swap Space <a href="#check-for-swap-space" class="header-anchor">#</a></h2><hr>
<p>Before we proceed to set up a swap file, we need to check if any swap files have been enabled on the VPS by looking at the summary of swap usage.</p>
<pre>sudo swapon -s</pre>
An empty list will confirm that you have no swap files enabled:
<pre>Filename                Type        Size    Used    Priority</pre>

<h2 id="check-the-file-system"><a href="#Check-the-File-System" class="headerlink" title="Check the File System"></a>Check the File System <a href="#check-the-file-system" class="header-anchor">#</a></h2><hr>
<p>After we know that we do not have a swap file enabled on the virtual server, we can check how much space we have on the server with the <code>df</code>command. The swap file will take 512MB&#x2014; since we are only using up about 8% of the /dev/sda, we can proceed.</p>
<pre>df
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/sda        20907056 1437188  18421292   8% /
udev              121588       4    121584   1% /dev
tmpfs              49752     208     49544   1% /run
none                5120       0      5120   0% /run/lock
none              124372       0    124372   0% /run/shm</pre>

<h2 id="create-and-enable-the-swap-file"><a href="#Create-and-Enable-the-Swap-File" class="headerlink" title="Create and Enable the Swap File"></a>Create and Enable the Swap File <a href="#create-and-enable-the-swap-file" class="header-anchor">#</a></h2><hr>
<p>Now it&#x2019;s time to create the swap file itself using the dd command :</p>
<pre>sudo dd if=/dev/zero of=/swapfile bs=1024 count=512k</pre>
&#x201C;of=/swapfile&#x201D; designates the file&#x2019;s name. In this case the name is swapfile.

Subsequently we are going to prepare the swap file by creating a linux swap area:
<pre>sudo mkswap /swapfile</pre>
The results display:
<pre>Setting up swapspace version 1, size = 262140 KiB
no label, UUID=103c4545-5fc5-47f3-a8b3-dfbdb64fd7eb</pre>
Finish up by activating the swap file:
<pre>sudo swapon /swapfile</pre>
You will then be able to see the new swap file when you view the swap summary.
<pre>swapon -s
Filename                Type        Size    Used    Priority
/swapfile                               file        262140    0    -1</pre>
This file will last on the virtual private server until the machine reboots. You can ensure that the swap is permanent by adding it to the fstab file.

Open up the file:
<pre>sudo nano /etc/fstab</pre>
Paste in the following line:
<pre> /swapfile       none    swap    sw      0       0</pre>
Swappiness in the file should be set to 0\. Skipping this step may cause both poor performance, whereas setting it to 0 will cause swap to act as an emergency buffer, preventing out-of-memory crashes.

You can do this with the following commands:
<pre>echo 0 | sudo tee /proc/sys/vm/swappiness
echo vm.swappiness = 0 | sudo tee -a /etc/sysctl.conf</pre>
To prevent the file from being world-readable, you should set up the correct permissions on the swap file:
<pre>sudo chown root:root /swapfile
sudo chmod 0600 /swapfile</pre>

<p>&#x53C2;&#x8003;&#x8D44;&#x6599;&#xFF1A;<a href="https://www.digitalocean.com/community/articles/how-to-add-swap-on-ubuntu-12-04" target="_blank" rel="external">https://www.digitalocean.com/community/articles/how-to-add-swap-on-ubuntu-12-04</a></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://hongzheng.me/2014/01/19/digitalocean-mysql/" data-id="cit3qzwvm000dnsonvrv17yef" class="article-share-link">Share</a><div class="tags"><a href="/tags/mysql/">mysql</a></div><div class="post-nav"><a href="/2014/01/20/vsftp_configuration/" class="pre">vsftp 配置</a><a href="/2014/01/19/yum_install_mongodb_nodejs/" class="next">用yum安装mongodb, nodejs</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://hongzheng.me"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/database/">database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/web/">web</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/政治与社会/">政治与社会</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/mysql/" style="font-size: 15px;">mysql</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/14/need-to-remember/">需要记住的算法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/14/bit-manipulate-summary/">Bit Manipulation 总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/14/sorting/">Sorting</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/09/14/find-the-difference/">389. Find the Difference</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/11/20/restart_from_hexo/">重新拾起我的博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/01/20/vsftp_configuration/">vsftp 配置</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/01/19/digitalocean-mysql/">DigitalOcean mysql无法启动</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/01/19/yum_install_mongodb_nodejs/">用yum安装mongodb, nodejs</a></li><li class="post-list-item"><a class="post-list-link" href="/2014/01/03/ajaxfileupload_ie8_problems/">AjaxFileUpload IE8 problems</a></li><li class="post-list-item"><a class="post-list-link" href="/2013/12/24/change_of_myself/">从一个愤青到自干五</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">reStart.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>